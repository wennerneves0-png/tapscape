<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Clique & Fuga ‚Äì Edi√ß√£o Definitiva</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg: #020617;
            --primary: #dc2626;
            --accent: #06b6d4;
            --text: #f8fafc;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            overflow: hidden;
            height: 100vh;
            user-select: none;
            touch-action: manipulation;
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px); }
            75% { transform: translateX(6px); }
        }
        .animate-shake { animation: shake 0.15s ease-in-out 3; }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }

        .game-btn {
            position: absolute;
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.2s;
            z-index: 20;
            touch-action: none;
        }

        .bg-glow {
            position: absolute;
            width: 50vw;
            height: 50vw;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
        }

        #hud {
            padding-top: calc(1rem + env(safe-area-inset-top));
            padding-left: calc(1rem + env(safe-area-inset-left));
            padding-right: calc(1rem + env(safe-area-inset-right));
        }

        .score-container {
            position: absolute;
            left: 50%;
            top: env(safe-area-inset-top);
            transform: translateX(-50%);
            text-align: center;
            pointer-events: none;
        }

        @media (max-width: 640px) {
            .game-btn {
                padding: 1rem 1.5rem !important;
                font-size: 0.75rem !important;
            }
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>
</head>
<body class="relative bg-slate-950">

    <!-- Ambient Glows -->
    <div class="bg-glow top-0 left-0 bg-blue-600 animate-pulse"></div>
    <div class="bg-glow bottom-0 right-0 bg-red-600 animate-pulse" style="animation-delay: 1s"></div>

    <!-- HUD (In-Game) -->
    <div id="hud" class="hidden absolute top-0 left-0 w-full z-30 pointer-events-none">
        <div class="score-container">
            <span class="text-cyan-500/50 text-[10px] font-orbitron tracking-widest uppercase" data-i18n="score_label">Score</span>
            <div id="score-display" class="text-white text-5xl md:text-8xl font-orbitron font-black drop-shadow-2xl leading-none">0</div>
            <div id="hud-nickname" class="text-slate-500 text-[9px] font-orbitron uppercase tracking-widest">---</div>
        </div>
        
        <div class="flex justify-between items-start w-full">
            <div class="flex flex-col opacity-0">spacer</div> <!-- Flex spacer -->
            <div class="text-right">
                <span class="text-red-500/50 text-[10px] font-orbitron tracking-widest uppercase" data-i18n="time_label">Tempo</span>
                <div id="timer-display" class="text-white text-2xl md:text-4xl font-orbitron font-bold">0.00s</div>
            </div>
        </div>

        <div class="mt-4 w-full h-1.5 bg-slate-900/80 rounded-full overflow-hidden border border-slate-800 backdrop-blur-sm">
            <div id="timer-bar" class="h-full bg-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.6)] transition-all duration-75 ease-linear" style="width: 100%"></div>
        </div>
    </div>

    <!-- Screen Darkness Overlay -->
    <div id="darkness" class="absolute inset-0 bg-black pointer-events-none z-10 opacity-0 transition-opacity duration-500"></div>

    <!-- Interactive Game Area -->
    <div id="game-area" class="absolute inset-0 z-20" onclick="handleMiss(event)"></div>

    <!-- Main Menu Overlay -->
    <div id="menu-overlay" class="fixed inset-0 z-50 flex items-center justify-center p-6 bg-slate-950/90 backdrop-blur-md">
        <div class="max-w-md w-full text-center space-y-10">
            <div>
                <h1 class="text-white font-orbitron text-5xl md:text-7xl font-black tracking-tighter leading-none mb-2">
                    CLIQUE <span class="text-red-600">&</span> FUGA
                </h1>
                <div class="h-1 w-24 bg-red-600 mx-auto rounded-full"></div>
            </div>

            <!-- Apelido Section -->
            <div id="nick-section" class="space-y-4">
                <p class="text-slate-400 text-sm" data-i18n="nick_instruction">Identifique-se para entrar no ranking mundial</p>
                <div class="flex flex-col gap-3">
                    <input type="text" id="nick-input" maxlength="10" placeholder="..." 
                        class="w-full bg-slate-900 border border-slate-800 rounded-2xl p-5 text-center font-orbitron text-white text-xl outline-none focus:border-cyan-500 transition-all">
                    <button onclick="saveNickname(event)" class="w-full py-5 bg-white text-slate-950 font-orbitron font-black rounded-2xl text-sm uppercase tracking-widest hover:bg-cyan-400 transition-all active:scale-95 shadow-xl" data-i18n="save_nick">
                        Salvar Apelido
                    </button>
                </div>
            </div>

            <!-- Modes Section -->
            <div id="modes-section" class="hidden space-y-4 animate-in fade-in slide-in-from-bottom-5 duration-500">
                <div class="mb-6">
                    <span class="text-slate-500 text-[10px] font-orbitron uppercase tracking-widest" data-i18n="agent_label">Agente Ativo</span>
                    <div id="active-nick" class="text-cyan-400 font-orbitron text-2xl font-bold">---</div>
                    <button onclick="changeNick(event)" class="text-[9px] text-slate-600 hover:text-white uppercase mt-1" data-i18n="change_profile">Trocar Perfil</button>
                </div>

                <div class="grid gap-4">
                    <button onclick="startGame('PRINCIPIANTE', event)" class="group relative p-5 bg-emerald-600/90 hover:bg-emerald-500 rounded-2xl text-left border border-emerald-400/30 transition-all hover:scale-[1.02] active:scale-95">
                        <span class="block font-orbitron font-black text-xl text-white">PRINCIPIANTE</span>
                        <span class="text-xs text-white/70" data-i18n="mode_beginner_desc">1 Bot√£o ‚Ä¢ Tempo Estendido</span>
                    </button>
                    <button onclick="startGame('CAOTICO', event)" class="group relative p-5 bg-orange-600/90 hover:bg-orange-500 rounded-2xl text-left border border-orange-400/30 transition-all hover:scale-[1.02] active:scale-95">
                        <span class="block font-orbitron font-black text-xl text-white">CA√ìTICO</span>
                        <span class="text-xs text-white/70" data-i18n="mode_chaotic_desc">2 Bot√µes ‚Ä¢ Reflexo M√©dio</span>
                    </button>
                    <button onclick="startGame('EXPERT', event)" class="group relative p-5 bg-red-700/90 hover:bg-red-600 rounded-2xl text-left border border-red-400/30 transition-all hover:scale-[1.02] active:scale-95">
                        <span class="block font-orbitron font-black text-xl text-white">EXPERT</span>
                        <span class="text-xs text-white/70" data-i18n="mode_expert_desc">3 Bot√µes ‚Ä¢ Morte S√∫bita</span>
                    </button>
                </div>
                
                <button onclick="toggleRanking(true, event)" class="w-full py-4 text-slate-500 font-orbitron font-bold text-xs uppercase tracking-widest hover:text-white transition-colors" data-i18n="world_ranking">
                    üèÜ Ranking Mundial
                </button>
            </div>
        </div>
    </div>

    <!-- Game Over Overlay -->
    <div id="game-over-overlay" class="hidden fixed inset-0 z-[60] flex items-center justify-center p-6 bg-slate-950/95 backdrop-blur-xl">
        <div class="max-w-md w-full text-center space-y-8 animate-in zoom-in duration-300">
            <h2 class="text-white font-orbitron text-5xl font-black tracking-tighter" data-i18n="game_over">FIM DE JOGO</h2>
            
            <div id="ai-coach" class="text-slate-400 italic text-sm px-8 min-h-[3em] flex items-center justify-center" data-i18n="default_coach">"Fim da linha."</div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-900 border border-slate-800 p-6 rounded-3xl">
                    <span class="block text-slate-500 text-[10px] font-orbitron uppercase" data-i18n="score_label">SCORE</span>
                    <span id="final-score" class="text-white text-4xl font-orbitron font-black">0</span>
                </div>
                <div class="bg-slate-900 border border-slate-800 p-6 rounded-3xl">
                    <span class="block text-slate-500 text-[10px] font-orbitron uppercase" data-i18n="best_label">BEST</span>
                    <span id="best-score" class="text-white text-4xl font-orbitron font-black">0</span>
                </div>
            </div>

            <div class="space-y-3">
                <button onclick="restartGame(event)" class="w-full py-5 bg-red-600 hover:bg-red-500 text-white font-orbitron font-black rounded-2xl text-sm uppercase tracking-widest shadow-xl transition-all active:scale-95" data-i18n="restart_mission">
                    Reiniciar
                </button>
                <button onclick="backToMenu(event)" class="w-full py-4 bg-slate-800 hover:bg-slate-700 text-slate-300 font-orbitron font-bold rounded-2xl text-xs uppercase tracking-widest transition-all" data-i18n="back_to_menu">
                    Menu Principal
                </button>
            </div>
        </div>
    </div>

    <!-- Ranking Modal -->
    <div id="ranking-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md">
        <div class="max-w-2xl w-full bg-slate-900 border border-slate-800 rounded-3xl overflow-hidden flex flex-col h-[80vh]">
            <div class="p-6 border-b border-slate-800 flex justify-between items-center">
                <h3 class="text-white font-orbitron text-xl font-black" data-i18n="top_100_label">TOP 100 GLOBAL</h3>
                <button onclick="toggleRanking(false, event)" class="text-slate-500 hover:text-white text-2xl">‚úï</button>
            </div>
            <div id="ranking-list" class="flex-1 overflow-y-auto p-6 space-y-2 custom-scrollbar">
                <div class="text-center text-slate-600 py-20 font-orbitron" data-i18n="loading_label">Carregando...</div>
            </div>
        </div>
    </div>

    <!-- Core Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { GoogleGenAI } from "@google/genai";

        // i18n Dictionary
        const i18n = {
            'pt': {
                score_label: 'Score',
                time_label: 'Tempo',
                nick_instruction: 'Identifique-se para entrar no ranking mundial',
                nick_placeholder: 'Seu apelido...',
                save_nick: 'Salvar Apelido',
                agent_label: 'Agente Ativo',
                change_profile: 'Trocar Perfil',
                mode_beginner_desc: '1 Bot√£o ‚Ä¢ Tempo Estendido',
                mode_chaotic_desc: '2 Bot√µes ‚Ä¢ Reflexo M√©dio',
                mode_expert_desc: '3 Bot√µes ‚Ä¢ Morte S√∫bita',
                world_ranking: 'üèÜ Ranking Mundial',
                game_over: 'FIM DE JOGO',
                best_label: 'BEST',
                restart_mission: 'Reiniciar',
                back_to_menu: 'Menu Principal',
                top_100_label: 'TOP 100 GLOBAL',
                loading_label: 'Carregando...',
                default_coach: 'Fim da linha.',
                click_btn: 'CLICA!',
                no_btn: 'N√ÉO!',
                ai_prompt: (s, m, b) => `Sou um jogador que fez ${s} pontos no modo ${m} do jogo "Clique & Fuga". Meu recorde √© ${b}. D√™ um coment√°rio curto e sarc√°stico em portugu√™s do Brasil.`
            },
            'en': {
                score_label: 'Score',
                time_label: 'Time',
                nick_instruction: 'Identify yourself for the world ranking',
                nick_placeholder: 'Your nickname...',
                save_nick: 'Save Nickname',
                agent_label: 'Active Agent',
                change_profile: 'Change Profile',
                mode_beginner_desc: '1 Button ‚Ä¢ Extended Time',
                mode_chaotic_desc: '2 Buttons ‚Ä¢ Medium Reflex',
                mode_expert_desc: '3 Buttons ‚Ä¢ Sudden Death',
                world_ranking: 'üèÜ World Ranking',
                game_over: 'GAME OVER',
                best_label: 'BEST',
                restart_mission: 'Restart',
                back_to_menu: 'Main Menu',
                top_100_label: 'TOP 100 GLOBAL',
                loading_label: 'Loading...',
                default_coach: 'End of the line.',
                click_btn: 'CLICK!',
                no_btn: 'NO!',
                ai_prompt: (s, m, b) => `I am a player who scored ${s} points in ${m} mode in "Clique & Fuga". My record is ${b}. Give a short and sarcastic comment in English.`
            },
            'es': {
                score_label: 'Puntaje',
                time_label: 'Tiempo',
                nick_instruction: 'Identif√≠cate para el ranking mundial',
                nick_placeholder: 'Tu apodo...',
                save_nick: 'Guardar Apodo',
                agent_label: 'Agente Activo',
                change_profile: 'Cambiar Perfil',
                mode_beginner_desc: '1 Bot√≥n ‚Ä¢ Tiempo Extendido',
                mode_chaotic_desc: '2 Botones ‚Ä¢ Reflejo Medio',
                mode_expert_desc: '3 Botones ‚Ä¢ Muerte S√∫bita',
                world_ranking: 'üèÜ Ranking Mundial',
                game_over: 'FIN DEL JUEGO',
                best_label: 'RECORD',
                restart_mission: 'Reiniciar',
                back_to_menu: 'Men√∫ Principal',
                top_100_label: 'TOP 100 GLOBAL',
                loading_label: 'Cargando...',
                default_coach: 'Fin del camino.',
                click_btn: '¬°CLICK!',
                no_btn: '¬°NO!',
                ai_prompt: (s, m, b) => `Soy un jugador que obtuvo ${s} puntos en el modo ${m} del juego "Clique & Fuga". Mi r√©cord es ${b}. Dame un comentario corto y sarc√°stico en espa√±ol.`
            }
        };

        const userLang = (navigator.language || 'pt').split('-')[0];
        const lang = i18n[userLang] ? userLang : 'pt';
        const t = i18n[lang];

        // Apply translations
        function applyTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (t[key]) el.innerText = t[key];
            });
            document.getElementById('nick-input').placeholder = t.nick_placeholder;
        }

        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAJ0x-V8ClngnDWL-ariKD9IE3pkYKP34w",
            authDomain: "tapscape-18a04.firebaseapp.com",
            projectId: "tapscape-18a04",
            storageBucket: "tapscape-18a04.firebasestorage.app",
            messagingSenderId: "459967807682",
            appId: "1:459967807682:web:311e75a85247c18cfb3b5b"
        };
        const fbApp = initializeApp(firebaseConfig);
        const db = getFirestore(fbApp);

        const MODES = {
            PRINCIPIANTE: { initialTime: 5000, reduction: 45, minTime: 900, buttons: 1, scale: 0.012, darkness: 0.01 },
            CAOTICO:      { initialTime: 2500, reduction: 65, minTime: 500, buttons: 2, scale: 0.022, darkness: 0.03 },
            EXPERT:       { initialTime: 1300, reduction: 85, minTime: 300, buttons: 3, scale: 0.040, darkness: 0.05 }
        };

        // Estado do Jogo
        let gameActive = false;
        let score = 0;
        let timeLeft = 0;
        let maxTime = 0;
        let currentModeId = '';
        let currentModeConfig = null;
        let timerInterval = null;
        let audioCtx = null;
        let nickname = localStorage.getItem('player-name') || '';

        // Refs de Interface
        const menuOverlay = document.getElementById('menu-overlay');
        const nickSection = document.getElementById('nick-section');
        const modesSection = document.getElementById('modes-section');
        const nickInput = document.getElementById('nick-input');
        const activeNickLabel = document.getElementById('active-nick');
        const hud = document.getElementById('hud');
        const gameArea = document.getElementById('game-area');
        const scoreDisplay = document.getElementById('score-display');
        const timerDisplay = document.getElementById('timer-display');
        const timerBar = document.getElementById('timer-bar');
        const gameOverOverlay = document.getElementById('game-over-overlay');
        const darknessOverlay = document.getElementById('darkness');

        // Inicializa√ß√£o
        window.onload = () => {
            applyTranslations();
            if (nickname) {
                nickInput.value = nickname;
                showModes();
            }
        };

        window.saveNickname = (e) => {
            if(e) e.stopPropagation();
            const val = nickInput.value.trim().substring(0, 10);
            if (!val) return;
            nickname = val;
            localStorage.setItem('player-name', nickname);
            showModes();
            initAudio(); 
        };

        window.changeNick = (e) => {
            if(e) e.stopPropagation();
            nickSection.classList.remove('hidden');
            modesSection.classList.add('hidden');
            nickInput.focus();
        };

        function showModes() {
            nickSection.classList.add('hidden');
            modesSection.classList.remove('hidden');
            activeNickLabel.innerText = nickname;
            document.getElementById('hud-nickname').innerText = nickname;
        }

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        function playSfx(freq, type = 'sine', vol = 0.08, dur = 0.1) {
            if (!audioCtx || audioCtx.state !== 'running') return;
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(vol, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + dur);
            osc.connect(g);
            g.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + dur);
        }

        window.startGame = (modeId, e) => {
            if(e) e.stopPropagation();
            initAudio();
            currentModeId = modeId;
            currentModeConfig = MODES[modeId];
            score = 0;
            maxTime = currentModeConfig.initialTime;
            timeLeft = maxTime;
            
            gameActive = false; 

            menuOverlay.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');
            hud.classList.remove('hidden');
            darknessOverlay.style.opacity = '0';
            
            spawnButtons();
            
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!gameActive) return;
                timeLeft -= 10;
                updateHUD();
                if (timeLeft <= 0) endGame();
            }, 10);

            setTimeout(() => { gameActive = true; }, 150);
        };

        function updateHUD() {
            scoreDisplay.innerText = score;
            timerDisplay.innerText = (Math.max(0, timeLeft) / 1000).toFixed(2) + 's';
            const pct = (timeLeft / maxTime) * 100;
            timerBar.style.width = Math.max(0, pct) + '%';
            
            if (pct < 30) timerBar.className = "h-full bg-red-500 shadow-[0_0_15px_rgba(239,68,68,0.8)]";
            else if (pct < 60) timerBar.className = "h-full bg-orange-500 shadow-[0_0_15px_rgba(249,115,22,0.6)]";
            else timerBar.className = "h-full bg-cyan-500 shadow-[0_0_15px_rgba(6,182,212,0.6)]";
        }

        function spawnButtons() {
            gameArea.innerHTML = '';
            const correctIdx = Math.floor(Math.random() * currentModeConfig.buttons);
            const scale = Math.max(0.4, 1.3 - (score * currentModeConfig.scale));

            for (let i = 0; i < currentModeConfig.buttons; i++) {
                const btn = document.createElement('button');
                const isCorrect = i === correctIdx;
                
                btn.className = `game-btn px-10 py-6 rounded-2xl border-2 font-orbitron font-black text-white text-base tracking-tighter shadow-2xl transition-all active:scale-90 ${
                    isCorrect ? 'bg-red-600 border-red-400' : 'bg-slate-800 border-slate-700'
                }`;
                btn.innerText = isCorrect ? t.click_btn : t.no_btn;
                
                const x = 20 + Math.random() * 60;
                const y = 30 + Math.random() * 50;
                btn.style.left = x + '%';
                btn.style.top = y + '%';
                btn.style.transform = `translate(-50%, -50%) scale(${scale})`;

                btn.onclick = (e) => {
                    e.stopPropagation();
                    if (!gameActive) return;
                    if (isCorrect) handleHit();
                    else handleMiss(e);
                };
                gameArea.appendChild(btn);
            }
        }

        function handleHit() {
            playSfx(880, 'sine', 0.05, 0.08);
            score++;
            
            maxTime = Math.max(currentModeConfig.minTime, currentModeConfig.initialTime - (score * currentModeConfig.reduction));
            timeLeft = maxTime;
            
            if (currentModeId !== 'PRINCIPIANTE') {
                darknessOverlay.style.opacity = Math.min(0.85, score * currentModeConfig.darkness);
            }
            
            spawnButtons();
            updateHUD();
        }

        window.handleMiss = (e) => {
            if (!gameActive) return;
            playSfx(110, 'sawtooth', 0.4, 0.3);
            playSfx(55, 'square', 0.2, 0.1);
            document.body.classList.add('animate-shake');
            setTimeout(() => document.body.classList.remove('animate-shake'), 450);
            endGame();
        };

        async function endGame() {
            gameActive = false;
            if(timerInterval) clearInterval(timerInterval);
            timerInterval = null;
            gameArea.innerHTML = '';
            
            gameOverOverlay.classList.remove('hidden');
            document.getElementById('final-score').innerText = score;
            
            const highKey = `cf-best-${currentModeId}`;
            const best = Math.max(score, parseInt(localStorage.getItem(highKey) || '0'));
            localStorage.setItem(highKey, best);
            document.getElementById('best-score').innerText = best;

            saveScoreGlobal();
            getAiCoachComment(score, best);
        }

        async function saveScoreGlobal() {
            if (score < 1) return;
            try {
                await addDoc(collection(db, "ranking"), {
                    name: nickname,
                    score: score,
                    mode: currentModeId,
                    timestamp: Date.now()
                });
            } catch (e) { console.error("Firebase error:", e); }
        }

        async function getAiCoachComment(s, b) {
            try {
                const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                const response = await ai.models.generateContent({
                    model: 'gemini-3-flash-preview',
                    contents: t.ai_prompt(s, currentModeId, b)
                });
                if (response.text) document.getElementById('ai-coach').innerText = `"${response.text.trim()}"`;
            } catch (e) {}
        }

        window.restartGame = (e) => {
            if(e) e.stopPropagation();
            startGame(currentModeId);
        };

        window.backToMenu = (e) => {
            if(e) e.stopPropagation();
            gameActive = false;
            hud.classList.add('hidden');
            gameOverOverlay.classList.add('hidden');
            menuOverlay.classList.remove('hidden');
            showModes();
        };

        window.toggleRanking = (show, e) => {
            if(e) e.stopPropagation();
            const modal = document.getElementById('ranking-modal');
            if (show) {
                modal.classList.remove('hidden');
                loadRanking();
            } else {
                modal.classList.add('hidden');
            }
        };

        function loadRanking() {
            const list = document.getElementById('ranking-list');
            const q = query(collection(db, "ranking"), orderBy("score", "desc"), limit(100));
            onSnapshot(q, (snap) => {
                list.innerHTML = '';
                if (snap.empty) {
                    list.innerHTML = '<div class="text-slate-600 text-center py-10 font-orbitron">...</div>';
                    return;
                }
                let i = 1;
                snap.forEach(doc => {
                    const d = doc.data();
                    const item = document.createElement('div');
                    item.className = "flex items-center justify-between p-4 bg-slate-800/40 rounded-xl border border-slate-800/60";
                    item.innerHTML = `
                        <div class="flex items-center gap-4">
                            <span class="text-slate-500 font-orbitron text-xs w-6">${i}¬∫</span>
                            <span class="font-orbitron font-bold text-white">${d.name || '---'}</span>
                        </div>
                        <div class="text-right">
                             <div class="font-orbitron font-black text-cyan-400 text-lg">${d.score}</div>
                             <div class="text-[8px] text-slate-600 uppercase font-orbitron">${d.mode}</div>
                        </div>
                    `;
                    list.appendChild(item);
                    i++;
                });
            });
        }
    </script>
</body>
</html>